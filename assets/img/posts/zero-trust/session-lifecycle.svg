<svg width="800" height="330" viewBox="0 0 800 330" xmlns="http://www.w3.org/2000/svg" font-family="'Segoe UI',system-ui,sans-serif">
  <defs>
    <linearGradient id="bg" x1="0" y1="0" x2="1" y2="1" gradientUnits="objectBoundingBox">
      <stop offset="0%" stop-color="#eef2ff"/>
      <stop offset="100%" stop-color="#f8fafc"/>
    </linearGradient>
    <filter id="sh">
      <feDropShadow dx="0" dy="2" stdDeviation="3" flood-color="#00000018"/>
    </filter>
  </defs>

  <rect width="800" height="330" fill="url(#bg)"/>

  <!-- Title -->
  <text x="400" y="24" text-anchor="middle" fill="#1e293b" font-size="14" font-weight="700">Session Lifecycle: Protocol Break and Re-Origination</text>

  <!-- ── Timeline axis ── -->
  <line x1="40" y1="90" x2="760" y2="90" stroke="#cbd5e1" stroke-width="2"/>
  <!-- arrow -->
  <polygon points="758,86 770,90 758,94" fill="#cbd5e1"/>
  <text x="775" y="94" fill="#94a3b8" font-size="9">time</text>

  <!-- ── Phase markers on axis ── -->
  <!-- t=0: Handshake -->
  <circle cx="100" cy="90" r="6" fill="#2563eb"/>
  <text x="100" y="78" text-anchor="middle" fill="#2563eb" font-size="8.5" font-weight="700">t=0</text>
  <!-- t=mid: Requests flowing -->
  <circle cx="320" cy="90" r="4" fill="#94a3b8"/>
  <!-- t=TTL: FIN -->
  <circle cx="490" cy="90" r="6" fill="#f59e0b"/>
  <text x="490" y="78" text-anchor="middle" fill="#f59e0b" font-size="8.5" font-weight="700">t=TTL</text>
  <!-- t=reconnect: new handshake -->
  <circle cx="600" cy="90" r="6" fill="#2563eb"/>
  <text x="600" y="78" text-anchor="middle" fill="#2563eb" font-size="8.5" font-weight="700">t+Δ</text>
  <!-- outcome -->
  <circle cx="720" cy="90" r="6" fill="#27ae60"/>

  <!-- ── Phase 1: Handshake (t=0) ── -->
  <rect x="40" y="106" width="190" height="96" rx="8" fill="white" stroke="#2563eb" stroke-width="1.8" filter="url(#sh)"/>
  <path d="M48,106 L222,106 Q230,106 230,114 L230,126 L40,126 L40,114 Q40,106 48,106 Z" fill="#2563eb"/>
  <text x="135" y="120" text-anchor="middle" fill="white" font-size="9" font-weight="700">① mTLS Handshake</text>
  <text x="135" y="142" text-anchor="middle" fill="#64748b" font-size="8">TCP connect</text>
  <text x="135" y="156" text-anchor="middle" fill="#64748b" font-size="8">Client presents device cert</text>
  <text x="135" y="170" text-anchor="middle" fill="#64748b" font-size="8">Proxy validates: CA, expiry,</text>
  <text x="135" y="184" text-anchor="middle" fill="#64748b" font-size="8">revocation (OCSP staple)</text>
  <!-- session open indicator -->
  <line x1="100" y1="90" x2="100" y2="106" stroke="#2563eb" stroke-width="1.4" stroke-dasharray="3 2"/>

  <!-- ── Phase 2: Session active ── -->
  <!-- green bar spanning session duration -->
  <rect x="100" y="83" width="390" height="14" rx="4" fill="#27ae60" opacity="0.18"/>
  <rect x="100" y="83" width="390" height="14" rx="4" fill="none" stroke="#27ae60" stroke-width="1.2"/>
  <text x="295" y="93" text-anchor="middle" fill="#166534" font-size="8" font-weight="600">session active · requests multiplexing over HTTP/2</text>

  <!-- requests flowing (small tick marks) -->
  <g stroke="#4f8ef7" stroke-width="1.5">
    <line x1="180" y1="86" x2="180" y2="97"/><line x1="230" y1="86" x2="230" y2="97"/>
    <line x1="280" y1="86" x2="280" y2="97"/><line x1="340" y1="86" x2="340" y2="97"/>
    <line x1="390" y1="86" x2="390" y2="97"/><line x1="440" y1="86" x2="440" y2="97"/>
  </g>

  <!-- ── Phase 3: TTL hit → TCP FIN ── -->
  <rect x="410" y="106" width="164" height="96" rx="8" fill="white" stroke="#f59e0b" stroke-width="1.8" filter="url(#sh)"/>
  <path d="M418,106 L566,106 Q574,106 574,114 L574,126 L410,126 L410,114 Q410,106 418,106 Z" fill="#f59e0b"/>
  <text x="492" y="120" text-anchor="middle" fill="white" font-size="9" font-weight="700">② TTL Reached → FIN</text>
  <text x="492" y="142" text-anchor="middle" fill="#64748b" font-size="8">Proxy sends TCP FIN</text>
  <text x="492" y="156" text-anchor="middle" fill="#64748b" font-size="8">Session terminated gracefully</text>
  <text x="492" y="170" text-anchor="middle" fill="#64748b" font-size="8">Client must reconnect</text>
  <text x="492" y="184" text-anchor="middle" fill="#78350f" font-size="8" font-weight="600">re-origination begins</text>
  <line x1="490" y1="90" x2="490" y2="106" stroke="#f59e0b" stroke-width="1.4" stroke-dasharray="3 2"/>

  <!-- ── Phase 4: Reconnect + OCSP check ── -->
  <rect x="556" y="106" width="164" height="96" rx="8" fill="white" stroke="#2563eb" stroke-width="1.8" filter="url(#sh)"/>
  <path d="M564,106 L712,106 Q720,106 720,114 L720,126 L556,126 L556,114 Q556,106 564,106 Z" fill="#2563eb"/>
  <text x="638" y="120" text-anchor="middle" fill="white" font-size="9" font-weight="700">③ Reconnect · OCSP Check</text>
  <text x="638" y="142" text-anchor="middle" fill="#64748b" font-size="8">New TCP connection</text>
  <text x="638" y="156" text-anchor="middle" fill="#64748b" font-size="8">New TLS handshake</text>
  <text x="638" y="170" text-anchor="middle" fill="#64748b" font-size="8">Cert validated vs. current</text>
  <text x="638" y="184" text-anchor="middle" fill="#64748b" font-size="8">revocation state</text>
  <line x1="600" y1="90" x2="600" y2="106" stroke="#2563eb" stroke-width="1.4" stroke-dasharray="3 2"/>

  <!-- ── Outcomes (two paths) ── -->
  <!-- Outcome A: cert still valid -->
  <rect x="556" y="220" width="164" height="46" rx="8" fill="#f0fff4" stroke="#27ae60" stroke-width="1.8" filter="url(#sh)"/>
  <text x="638" y="241" text-anchor="middle" fill="#166534" font-size="9" font-weight="700">✓ Cert valid</text>
  <text x="638" y="257" text-anchor="middle" fill="#166534" font-size="8">Session re-established</text>
  <line x1="638" y1="202" x2="638" y2="220" stroke="#27ae60" stroke-width="1.4"/>

  <!-- Outcome B: cert revoked → blocked -->
  <rect x="40" y="220" width="220" height="46" rx="8" fill="#fff0f0" stroke="#e74c3c" stroke-width="1.8" filter="url(#sh)"/>
  <text x="150" y="241" text-anchor="middle" fill="#c0392b" font-size="9" font-weight="700">✗ Cert revoked</text>
  <text x="150" y="257" text-anchor="middle" fill="#c0392b" font-size="8">Handshake fails · no re-entry</text>
  <!-- path from reconnect box down-left to revoked outcome -->
  <path d="M556,160 L290,160 L150,220" fill="none" stroke="#e74c3c" stroke-width="1.6" stroke-dasharray="5 3"/>
  <polygon points="148,218 144,230 156,224" fill="#e74c3c"/>

  <!-- Exposure window bracket -->
  <line x1="100" y1="278" x2="490" y2="278" stroke="#94a3b8" stroke-width="1.2"/>
  <line x1="100" y1="274" x2="100" y2="282" stroke="#94a3b8" stroke-width="1.2"/>
  <line x1="490" y1="274" x2="490" y2="282" stroke="#94a3b8" stroke-width="1.2"/>
  <text x="295" y="295" text-anchor="middle" fill="#94a3b8" font-size="8.5" font-style="italic">worst-case exposure window = one session TTL (e.g. 15 min)</text>

  <!-- Caption -->
  <text x="400" y="318" text-anchor="middle" fill="#94a3b8" font-size="9" font-style="italic">Every reconnect is a fresh certificate check. Revocation is enforced at the next handshake, not just at first login.</text>
</svg>
