<svg width="800" height="248" viewBox="0 0 800 248" xmlns="http://www.w3.org/2000/svg" font-family="'Segoe UI',system-ui,sans-serif">
  <defs>
    <linearGradient id="bg" x1="0" y1="0" x2="1" y2="1" gradientUnits="objectBoundingBox">
      <stop offset="0%" stop-color="#eef2ff"/>
      <stop offset="100%" stop-color="#f8fafc"/>
    </linearGradient>
    <marker id="arrowR" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto">
      <path d="M0,0 L0,6 L8,3 z" fill="#e74c3c"/>
    </marker>
    <marker id="arrowD" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto">
      <path d="M0,0 L0,6 L8,3 z" fill="#64748b"/>
    </marker>
    <filter id="sh">
      <feDropShadow dx="0" dy="2" stdDeviation="3" flood-color="#00000018"/>
    </filter>
  </defs>

  <rect width="800" height="248" fill="url(#bg)"/>

  <!-- Title -->
  <text x="400" y="24" text-anchor="middle" fill="#1e293b" font-size="14" font-weight="700">Passive Health Checks: Failure Detected on the First Bad Request</text>

  <!-- ── Divider ── -->
  <line x1="430" y1="38" x2="430" y2="230" stroke="#e2e8f0" stroke-width="1.5" stroke-dasharray="4 4"/>
  <text x="612" y="50" text-anchor="middle" fill="#94a3b8" font-size="9" font-style="italic">Client B — no request sent yet</text>

  <!-- ══ LEFT: Client A flow ══ -->

  <!-- Step 1: Client A sends request -->
  <rect x="30" y="42" width="160" height="42" rx="8" fill="white" stroke="#4f8ef7" stroke-width="1.8" filter="url(#sh)"/>
  <text x="110" y="60" text-anchor="middle" fill="#4f8ef7" font-size="10" font-weight="700">Client A</text>
  <text x="110" y="75" text-anchor="middle" fill="#64748b" font-size="8.5">sends request</text>

  <!-- Arrow → Instance 3 -->
  <line x1="192" y1="63" x2="268" y2="63" stroke="#e74c3c" stroke-width="1.8" marker-end="url(#arrowR)"/>

  <!-- Instance 3 box (failed) -->
  <rect x="270" y="42" width="140" height="42" rx="8" fill="#fff0f0" stroke="#e74c3c" stroke-width="1.8" filter="url(#sh)"/>
  <text x="340" y="60" text-anchor="middle" fill="#c0392b" font-size="10" font-weight="700">Instance 3</text>
  <text x="340" y="75" text-anchor="middle" fill="#e74c3c" font-size="8.5" font-weight="600">connection refused</text>

  <!-- Arrow ↓ from Instance 3 back to Client A state area -->
  <line x1="340" y1="86" x2="340" y2="106" stroke="#e74c3c" stroke-width="1.5" stroke-dasharray="3 2"/>
  <line x1="340" y1="106" x2="110" y2="106" stroke="#e74c3c" stroke-width="1.5" stroke-dasharray="3 2"/>
  <line x1="110" y1="106" x2="110" y2="117" stroke="#e74c3c" stroke-width="1.5" marker-end="url(#arrowR)"/>

  <!-- Step 2: Client A state update -->
  <rect x="30" y="119" width="340" height="54" rx="8" fill="#fff0f0" stroke="#e74c3c" stroke-width="1.8" filter="url(#sh)"/>
  <text x="200" y="138" text-anchor="middle" fill="#c0392b" font-size="10" font-weight="700">Client A updates local state</text>
  <text x="200" y="153" text-anchor="middle" fill="#374151" font-size="9">Instance 3 → unhealthy</text>
  <text x="200" y="166" text-anchor="middle" fill="#374151" font-size="9">stops routing to Instance 3 for 30 s</text>

  <!-- Arrow ↓ to result -->
  <line x1="200" y1="175" x2="200" y2="187" stroke="#64748b" stroke-width="1.4" marker-end="url(#arrowD)"/>

  <!-- Result box -->
  <rect x="30" y="189" width="340" height="32" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="1.5" filter="url(#sh)"/>
  <text x="200" y="209" text-anchor="middle" fill="#92400e" font-size="9.5" font-weight="600">Failure detected immediately — no polling interval to wait through</text>

  <!-- ══ RIGHT: Client B view ══ -->

  <!-- Client B box -->
  <rect x="448" y="60" width="160" height="42" rx="8" fill="white" stroke="#4f8ef7" stroke-width="1.8" filter="url(#sh)"/>
  <text x="528" y="78" text-anchor="middle" fill="#4f8ef7" font-size="10" font-weight="700">Client B</text>
  <text x="528" y="92" text-anchor="middle" fill="#64748b" font-size="8.5">no request to Instance 3</text>

  <!-- Instance 3 as seen by Client B (still green) -->
  <rect x="448" y="130" width="140" height="42" rx="8" fill="#f0fff4" stroke="#27ae60" stroke-width="1.8" filter="url(#sh)"/>
  <text x="518" y="148" text-anchor="middle" fill="#166534" font-size="10" font-weight="700">Instance 3</text>
  <text x="518" y="163" text-anchor="middle" fill="#27ae60" font-size="8.5" font-weight="600">healthy  ✓  (stale view)</text>

  <!-- Client B "still thinks healthy" note -->
  <rect x="448" y="192" width="310" height="29" rx="6" fill="#f0fff4" stroke="#27ae60" stroke-width="1.2"/>
  <text x="603" y="211" text-anchor="middle" fill="#166534" font-size="9">Still routing to Instance 3 — hasn't seen a failure yet</text>

  <!-- Caption -->
  <text x="400" y="241" text-anchor="middle" fill="#94a3b8" font-size="9" font-style="italic">Passive checks are instant but require one real request to fail. Different clients converge at different times.</text>
</svg>
